<!-- @@master = ./templates/layout.html { "baseHref": "/ws-events/" } -->

<!-- @@block = main-->

<div class="wse__event-page" event-page>

	<div class="wse__section--event__hero" *if="event">
		<div [class]="{ 'wse__container-fluid': event.hasRelated, 'wse__container': !event.hasRelated }">
			<div class="wse__row">
				<div [class]="{ 'wse__col-md-9': event.hasRelated, 'wse__col-md-12': !event.hasRelated }">
					<div class="wse__event-media" *if="event.future">
						<!-- @@include ./templates/shared/event/card-incoming.html -->
					</div>
					<div class="wse__event-media" *if="!event.future && event.thron && event.live">
						<!-- @@include ./templates/shared/event/player-thron-live.html -->
					</div>
					<div class="wse__event-media" *if="!event.future && event.thron && !event.live">
						<!-- @@include ./templates/shared/event/player-thron.html -->
					</div>
					<div class="wse__section--event__header">
						<div class="wse__row">
							<div class="wse__col-md-6">
								<div class="wse__section--event__header__content">
									<div class="wse__section--event__header__title" [class]="{ 'wse__section--event__header__title--future': event.future }" [innerHTML]="event.name"></div>
								</div>
							</div>
							<div class="wse__col-md-6">
								<div class="wse__channel__info">
									<div class="wse__subscribe" [class]="{ 'wse__active': event.info.subscribed }" (click)="toggleSubscribe()">
										<div class="wse__info">
											<svg class="wse__icon--bell" *if="!event.info.subscribed"><use xlink:href="#bell"></use></svg>
											<svg class="wse__icon--bell" *if="event.info.subscribed"><use xlink:href="#bell-active"></use></svg>
											<span class="wse__count" [innerHTML]="event.info.subscribers | count"></span>
										</div>
										<div class="wse__label"><svg class="wse__icon--bell"><use xlink:href="#bell-active"></use></svg></div>
									</div>
									<div class="wse__like" [class]="{ 'wse__active': event.info.liked }" (click)="toggleLike()">
										<div class="wse__info">
											<svg class="wse__icon--heart" *if="!event.info.liked"><use xlink:href="#heart"></use></svg>
											<svg class="wse__icon--heart" *if="event.info.liked"><use xlink:href="#heart-active"></use></svg>
											<span class="wse__count" [innerHTML]="event.info.likes | count"></span>
										</div>
										<div class="wse__label"><svg class="wse__icon--heart"><use xlink:href="#heart-active"></use></svg></div>
									</div>
									<div class="wse__save" [class]="{ 'wse__active': event.info.saved }" (click)="toggleSave()">
										<div class="wse__info">
											<svg class="wse__icon--favourite" *if="!event.info.saved"><use xlink:href="#favourite"></use></svg>
											<svg class="wse__icon--favourite" *if="event.info.saved"><use xlink:href="#favourite-active"></use></svg>
											<span [innerHTML]="event.info.saved ? 'salvato' : 'salva'"></span>
										</div>
										<div class="wse__label">
											<svg class="wse__icon--favourite"><use xlink:href="#favourite-active"></use></svg>
											<span [innerHTML]="event.info.saved ? 'salvato' : 'salva'"></span>
										</div>
									</div>
									<!--
									<div class="wse__share" (click)="share()">
										<div class="wse__info">
											<svg class="wse__icon--share"><use xlink:href="#share"></use></svg>
											<span>condividi</span>
										</div>
										<div class="wse__label">
											<svg class="wse__icon--share"><use xlink:href="#share"></use></svg>
											<span>condividi</span>
										</div>
									</div>
									-->
								</div>
							</div>
						</div>
						<div class="wse__row">
							<div class="wse__col-md-6">
								<div class="wse__section--event__header__content">
									<a [href]="event.channel.url" class="wse__section--event__header__category" [innerHTML]="event.channel.name"></a>
									<div class="wse__section--event__header__abstract" [innerHTML]="event.abstract"></div>
								</div>
							</div>
							<div class="wse__col-md-6"></div>
						</div>
					</div>
					<div class="wse__group--questions">
						<div class="wse__group--question" *if="user">
							<div class="wse__avatar" [innerHTML]="user.avatar"></div>
							<div class="wse__group--message">
								<form class="wse__group--input-group" [class]="{ 'wse__active': inputActive }" [formGroup]="form" (submit)="postQuestion()" name="form" role="form" novalidate autocomplete="off">
									<input type="text" class="wse__group--message__input" [formControl]="form.controls.question" placeholder="Aggiungi una domanda pubblica..." />
									<button type="submit" class="wse__btn--rounded"><span>Invia</span></button>
								</form>
							</div>
						</div>
						<div class="wse__group--question" *for="let question of event.questions">
							<div class="wse__avatar" [innerHTML]="question.user.avatar"></div>
							<div class="wse__group--message">
								<div class="wse__group--message__head">
									<div class="wse__group--message__user" [innerHTML]="question.user.fullName"></div>
									<div class="wse__group--message__date" [relativeDate]="question.creationDate"></div>
								</div>
								<div class="wse__group--message__body" [innerHTML]="question.body"></div>
							</div>
						</div>
					</div>
				</div>
				<div class="wse__col-md-3" *if="event.hasRelated">
					<div class="wse__group--previews">
						<div class="wse__card--preview" [event]="related" *for="let related of event.related">
							<!-- @@include ./templates/shared/event/card-preview.html -->
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="wse__section--filters" *if="listing?.length">
		<div class="wse__container-fluid">
			<div class="wse__group--filters">
				<ul class="wse__nav--filters">
					<li class="wse__nav--filters__item wse__filter" *for="let option of filters.type.options">
						<span class="wse__filter__option" [class]="{ active: filters.type.has(option), disabled: option.disabled }" (click)="filters.type.set(option)">
							<span class="wse__name" *if="option.value === undefined">Tutto</span>
							<span class="wse__name" *if="option.value === 'event'"><span class="wse__text">Eventi</span><svg class="wse__ico"><use xlink:href="#event"></use></svg></span>
							<span class="wse__name" *if="option.value === 'picture'"><span class="wse__text">Immagini</span><svg class="wse__ico"><use xlink:href="#picture"></use></svg></span>
							<span class="wse__name" *if="option.value === 'product'"><span class="wse__text">Prodotti</span><svg class="wse__ico"><use xlink:href="#product"></use></svg></span>
							<span class="wse__name" *if="option.value === 'magazine'"><span class="wse__text">Magazine</span><svg class="wse__ico"><use xlink:href="#magazine"></use></svg></span>
							<span class="wse__count" [innerHTML]="option.count || ''"></span>
						</span>
					</li>
				</ul>
				<div class="wse__group--actions">
					<div class="wse__btn--mode" (click)="toggleGrid()">
						<svg class="wse__grid" *if="grid.width === 350"><use xlink:href="#grid"></use></svg>
						<svg class="wse__grid" *if="grid.width === 700"><use xlink:href="#grid-active"></use></svg>
					</div>
					<div class="wse__btn--filter">
						<svg class="wse__filter"><use xlink:href="#filter"></use></svg>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="wse__section--event__listing">
		<div class="wse__container-fluid">
			<div class="wse__group--grid" *virtual="let item of filteredItems" [mode]="grid.mode" [width]="grid.width" [gutter]="grid.gutter">
				<!-- serve un nodo figlio -->
				<div class="wse__section--channel__listing__item">
					<div [event]="item" *if="item.type === 'event'">
						<!-- @@include ./templates/shared/event/card-listing.html -->
					</div>
					<div *if="item.type === 'picture'">
						<!-- @@include ./templates/shared/generic/card-picture.html -->
					</div>
					<div *if="item.type === 'product'">
						<!-- @@include ./templates/shared/generic/card-product.html -->
					</div>
					<div *if="item.type === 'magazine'">
						<!-- @@include ./templates/shared/generic/card-magazine.html -->
					</div>
				</div>
			</div>
		</div>
	</div>


</div>

<!-- @@close-->
